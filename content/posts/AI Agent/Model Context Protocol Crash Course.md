---
categories:
- AI Agent
date: '2025-06-25T22:12:45+08:00'
draft: false
summary: MCP åè®®ï¼šAI å·¥å…·è°ƒç”¨çš„â€œUSB-Câ€ï¼Œå®ç°æ¨¡å‹ä¸å¤–éƒ¨èƒ½åŠ›æ ‡å‡†åŒ–äº’æ“ä½œã€‚
tags:
- MCP
- Agent
title: Model Context Protocol Crash Course
---

## 1 å¼•è¨€

å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åœ¨è‡ªç„¶è¯­è¨€ç†è§£å’Œç”Ÿæˆæ–¹é¢å±•ç°äº†æƒŠäººçš„èƒ½åŠ›ï¼Œä½†å®ƒä»¬é¢ä¸´ç€å‡ ä¸ªæ ¹æœ¬æ€§çš„é™åˆ¶ï¼š

- **çŸ¥è¯†çš„æ—¶æ•ˆæ€§é—®é¢˜**ï¼šLLM çš„çŸ¥è¯†åŸºäºè®­ç»ƒæ—¶çš„é™æ€æ•°æ®é›†ï¼Œå­˜åœ¨æ˜æ˜¾çš„"çŸ¥è¯†æˆªæ­¢æ—¥æœŸ"ã€‚å½“æˆ‘ä»¬è¯¢é—®æœ€æ–°çš„è‚¡ä»·ã€å¤©æ°”ä¿¡æ¯æˆ–çªå‘æ–°é—»æ—¶ï¼Œæ¨¡å‹åªèƒ½åŸºäºè¿‡æ—¶çš„è®­ç»ƒæ•°æ®è¿›è¡Œæ¨æµ‹ï¼Œæ— æ³•æä¾›å‡†ç¡®çš„å®æ—¶ä¿¡æ¯ã€‚
- **ä¸Šä¸‹æ–‡çª—å£çš„ç‰©ç†é™åˆ¶**ï¼šå°½ç®¡ç°ä»£ LLM çš„ä¸Šä¸‹æ–‡çª—å£ä¸æ–­æ‰©å¤§ï¼ˆä»æ—©æœŸçš„ 4K åˆ°ç°åœ¨çš„æ•°ç™¾ä¸‡ tokensï¼‰ï¼Œä½†ä»ç„¶å­˜åœ¨ç‰©ç†ä¸Šé™ã€‚å½“éœ€è¦å¤„ç†çš„ä¿¡æ¯è¶…å‡ºè¿™ä¸ªçª—å£æ—¶ï¼Œæ¨¡å‹å¿…é¡»åœ¨ä¿ç•™é‡è¦ä¿¡æ¯å’Œæ¥æ”¶æ–°ä¿¡æ¯ä¹‹é—´åšå‡ºæƒè¡¡ã€‚
- **è¢«åŠ¨ä¿¡æ¯å¤„ç†çš„å±€é™**ï¼šä¼ ç»Ÿçš„ LLM äº¤äº’æ¨¡å¼æ˜¯å•å‘çš„ï¼šç”¨æˆ·æä¾›è¾“å…¥ï¼Œæ¨¡å‹ç”Ÿæˆè¾“å‡ºã€‚æ¨¡å‹æ— æ³•ä¸»åŠ¨è·å–ä¿¡æ¯ã€æ‰§è¡Œè®¡ç®—æˆ–ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ï¼Œè¿™ä¸¥é‡é™åˆ¶äº†å…¶ä½œä¸ºæ™ºèƒ½åŠ©æ‰‹çš„å®ç”¨æ€§ã€‚

**æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆModel Context Protocol, MCPï¼‰** æ˜¯ç”± Anthropic å¼€å‘çš„å¼€æ”¾æ ‡å‡†ï¼Œæ—¨åœ¨è§£å†³ AI æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºä¹‹é—´çš„è¿æ¥é—®é¢˜ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œè®© AI æ¨¡å‹èƒ½å¤Ÿå®‰å…¨ã€é«˜æ•ˆåœ°è®¿é—®å„ç§å¤–éƒ¨èƒ½åŠ›ã€‚æ˜¯äººå·¥æ™ºèƒ½ç³»ç»Ÿä¸èƒ½åŠ›ï¼ˆå·¥å…·ç­‰ï¼‰ä¹‹é—´çš„é€šç”¨è¿æ¥å™¨ï¼Œç±»ä¼¼äº USB-C æ ‡å‡†åŒ–ç”µå­è®¾å¤‡ä¹‹é—´çš„è¿æ¥ã€‚

MCP çš„è®¾è®¡çµæ„Ÿæ¥æºäºè½¯ä»¶å¼€å‘é¢†åŸŸçš„**è¯­è¨€æœåŠ¡å™¨åè®®ï¼ˆLSPï¼‰**ã€‚æ­£å¦‚ LSP è®©ä»£ç ç¼–è¾‘å™¨èƒ½å¤Ÿä¸ä»»ä½•ç¼–ç¨‹è¯­è¨€çš„åˆ†æå¼•æ“æ ‡å‡†åŒ–é€šä¿¡ï¼ŒMCP è®© AI åº”ç”¨èƒ½å¤Ÿä¸ä»»ä½•å¤–éƒ¨å·¥å…·æ ‡å‡†åŒ–äº¤äº’ã€‚

![image.png](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/20250621105636.png)

---

## 2 LLMs çš„ä¸Šä¸‹æ–‡ç®¡ç†

LLM çš„å“åº”å®Œå…¨ä¾èµ–äºå…¶ä¸Šä¸‹æ–‡çª—å£å†…çš„è¾“å…¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·æç¤ºã€å¯¹è¯å†å²å’Œç›¸å…³æ•°æ®ã€‚ç„¶è€Œï¼ŒLLM é¢ä¸´ä¸¤ä¸ªæ ¸å¿ƒé™åˆ¶ï¼š**ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶**ï¼ˆè¶…å‡ºçª—å£çš„ä¿¡æ¯æ— æ³•è¢«"çœ‹åˆ°"ï¼‰å’Œ**çŸ¥è¯†æ—¶æ•ˆæ€§é—®é¢˜**ï¼ˆåªèƒ½åŸºäºè®­ç»ƒæˆªæ­¢æ—¥æœŸå‰çš„é™æ€çŸ¥è¯†ï¼‰ã€‚å› æ­¤ï¼Œæœ‰æ•ˆçš„ä¸Šä¸‹æ–‡ç®¡ç†éœ€è¦ä¸»åŠ¨å‘æ¨¡å‹æä¾›æœ€æ–°æˆ–ä¸“ä¸šåŒ–çš„ä¿¡æ¯æ¥å¼¥è¡¥è¿™äº›å±€é™ï¼Œè¿™æ­£æ˜¯ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç­‰æŠ€æœ¯è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€‚

### 2.1 ä¼ ç»Ÿæ–¹æ³•

- **æˆªæ–­/æ»‘åŠ¨çª—å£**ï¼šä¿ç•™æœ€è¿‘å¯¹è¯ï¼Œä¸¢å¼ƒæ—§ä¿¡æ¯ï¼Œæ˜“ä¸¢å¤±é‡è¦ä¸Šä¸‹æ–‡ã€‚
- **æ‘˜è¦æ³•**ï¼šå¯¹é•¿å†…å®¹åšæ‘˜è¦ï¼Œæ˜“ä¸¢å¤±ç»†èŠ‚ä¸”éœ€è¦é¢å¤–è®¡ç®—ã€‚
- **æ¨¡æ¿åŒ– prompt**ï¼šé¢„ç•™æ’æ§½ï¼ˆslotsï¼‰æ‰‹åŠ¨å¡«å……ä¿¡æ¯ï¼Œå¼€å‘è´Ÿæ‹…å¤§ã€‚

### 2.2 RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰

**RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æŠ€æœ¯**é€šè¿‡è®©å¤–éƒ¨ç³»ç»Ÿæ£€ç´¢ç›¸å…³æ–‡æ¡£æˆ–æ•°æ®ï¼Œå¹¶å°†ç»“æœæ³¨å…¥åˆ°æ¨¡å‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæœ‰æ•ˆè§£å†³äº† LLM çŸ¥è¯†è¿‡æ—¶å’Œé¢†åŸŸä¸“ä¸šæ€§ä¸è¶³çš„é—®é¢˜ã€‚

ç„¶è€Œï¼ŒRAG å­˜åœ¨ä¸¤ä¸ªæ ¹æœ¬æ€§å±€é™ï¼š

1. **è¢«åŠ¨æ€§é—®é¢˜**ï¼šæ¨¡å‹ä»ç„¶æ˜¯ä¿¡æ¯çš„è¢«åŠ¨æ¥æ”¶è€…ï¼Œæ— æ³•ä¸»åŠ¨å‘èµ·æ£€ç´¢è¯·æ±‚ï¼Œæ‰€æœ‰æ£€ç´¢é€»è¾‘éƒ½éœ€è¦å¼€å‘è€…é¢„å…ˆè®¾è®¡å’Œç¡¬ç¼–ç ã€‚
2. **åŠŸèƒ½å•ä¸€æ€§**ï¼šRAG ä¸»è¦ä¸“æ³¨äºçŸ¥è¯†æŸ¥æ‰¾å’Œæ–‡æœ¬æ£€ç´¢ï¼Œæ— æ³•è®©æ¨¡å‹æ‰§è¡Œå®é™…æ“ä½œæˆ–ä½¿ç”¨å¤šæ ·åŒ–çš„å¤–éƒ¨å·¥å…·ã€‚

è¿™äº›é™åˆ¶ä½¿å¾— RAG è™½ç„¶åœ¨ä¿¡æ¯å¢å¼ºæ–¹é¢å–å¾—äº†é‡è¦è¿›å±•ï¼Œä½†è·ç¦»çœŸæ­£çš„"æ™ºèƒ½ä»£ç†"ä»æœ‰å·®è·â€”â€”æ¨¡å‹éœ€è¦çš„ä¸ä»…æ˜¯æ›´å¤šä¿¡æ¯ï¼Œæ›´éœ€è¦ä¸»åŠ¨è·å–ä¿¡æ¯å’Œæ‰§è¡Œæ“ä½œçš„èƒ½åŠ›ã€‚è¿™æ­£æ˜¯ MCP ç­‰æ–°ä¸€ä»£åè®®è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼šä»è¢«åŠ¨çš„ä¿¡æ¯æ¶ˆè´¹è€…è½¬å˜ä¸ºä¸»åŠ¨çš„å·¥å…·ä½¿ç”¨è€…ã€‚

### 2.3 Prompt é“¾ä¸ Agent

**æç¤ºé“¾å’Œä»£ç†æŠ€æœ¯**ä»£è¡¨äº† LLM ä»è¢«åŠ¨ä¿¡æ¯å¤„ç†å‘ä¸»åŠ¨å·¥å…·ä½¿ç”¨çš„é‡è¦æ¼”è¿›ã€‚é€šè¿‡ **ReActï¼ˆæ¨ç† + è¡ŒåŠ¨ï¼‰æ¨¡å¼**ï¼Œæ¨¡å‹èƒ½å¤Ÿè¾“å‡ºç»“æ„åŒ–çš„å‘½ä»¤ï¼ˆå¦‚ `SEARCH: 'weather in SF'`ï¼‰ï¼Œç³»ç»Ÿè¯†åˆ«è¿™äº›å‘½ä»¤åè°ƒç”¨ç›¸åº”çš„å¤–éƒ¨å·¥å…·ï¼Œå¹¶å°†ç»“æœåé¦ˆç»™æ¨¡å‹è¿›è¡Œåç»­å¤„ç†ã€‚

è¿™ç§æ–¹æ³•çš„æ ¸å¿ƒä¼˜åŠ¿æ˜¯è®© LLM å…·å¤‡äº†**ä¸»åŠ¨æ€§**â€”â€”æ¨¡å‹å¯ä»¥æ ¹æ®éœ€è¦"å†³å®š"è°ƒç”¨ä»€ä¹ˆå·¥å…·ï¼Œè€Œä¸æ˜¯è¢«åŠ¨æ¥æ”¶é¢„è®¾çš„ä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™ä¸€é˜¶æ®µå­˜åœ¨æ˜¾è‘—çš„**æ ‡å‡†åŒ–ç¼ºå¤±é—®é¢˜**ï¼š

1. **å®ç°ç¢ç‰‡åŒ–**ï¼šæ¯ä¸ªå¼€å‘è€…éƒ½éœ€è¦æ„å»ºè‡ªå®šä¹‰çš„é“¾å¼é€»è¾‘å’Œè§£æç³»ç»Ÿ
2. **æ¨¡å‹å·®å¼‚æ€§**ï¼šä¸åŒ LLM è¡¨è¾¾å·¥å…·è°ƒç”¨çš„æ–¹å¼å„ä¸ç›¸åŒ
3. **é›†æˆå¤æ‚æ€§**ï¼šæ¯æ·»åŠ ä¸€ä¸ªæ–°å·¥å…·éƒ½éœ€è¦ç¼–å†™ä¸“é—¨çš„æç¤ºé€»è¾‘å’Œè¾“å‡ºè§£æä»£ç 

è¿™ç§"å„è‡ªä¸ºæ”¿"çš„çŠ¶æ€è™½ç„¶è¯æ˜äº† LLM å·¥å…·ä½¿ç”¨çš„å¯è¡Œæ€§ï¼Œä½†ç¼ºä¹ç»Ÿä¸€æ ‡å‡†ä½¿å¾—å¼€å‘æ•ˆç‡ä½ä¸‹ã€ç»´æŠ¤æˆæœ¬é«˜æ˜‚ï¼Œéš¾ä»¥å½¢æˆç”Ÿæ€è§„æ¨¡æ•ˆåº”ã€‚

### 2.4 å‡½æ•°è°ƒç”¨ Function Calling

**å‡½æ•°è°ƒç”¨æœºåˆ¶**æ ‡å¿—ç€ LLM å·¥å…·ä½¿ç”¨çš„é‡è¦æ ‡å‡†åŒ–é‡Œç¨‹ç¢‘ã€‚2023 å¹´ OpenAI å¼•å…¥çš„ Function Calling åŠŸèƒ½è®©å¼€å‘è€…èƒ½å¤Ÿé¢„å®šä¹‰ç»“æ„åŒ–å‡½æ•°ï¼Œæ¨¡å‹å¯ä»¥é€šè¿‡è¿”å›æ ‡å‡† JSON æ ¼å¼æ¥ç²¾ç¡®æŒ‡å®šè¦è°ƒç”¨çš„å‡½æ•°å’Œå‚æ•°ã€‚

ç›¸æ¯”ä¹‹å‰çš„æ–‡æœ¬è§£ææ–¹å¼ï¼ˆå¦‚ `SEARCH: 'weather in SF'`ï¼‰ï¼Œå‡½æ•°è°ƒç”¨æœºåˆ¶å®ç°äº†ï¼š

- **ç»“æ„åŒ–è¾“å‡º**ï¼šç»Ÿä¸€çš„ JSON æ ¼å¼æ›¿ä»£äº†ä¸å¯é çš„æ–‡æœ¬è§£æ
- **ç²¾ç¡®å‚æ•°ä¼ é€’**ï¼šæ˜ç¡®çš„å‡½æ•°åå’Œå‚æ•°ç»“æ„ï¼Œé¿å…äº†æ­§ä¹‰
- **æ ‡å‡†åŒ–æ¥å£**ï¼šæ¨¡å‹ä¸å¤–éƒ¨å·¥å…·ä¹‹é—´æœ‰äº†è§„èŒƒçš„é€šä¿¡åè®®

å°½ç®¡å‡½æ•°è°ƒç”¨åœ¨**æŠ€æœ¯å±‚é¢**å®ç°äº†æ ‡å‡†åŒ–ï¼Œä½†åœ¨**å¼€å‘ä½“éªŒ**ä¸Šä»ç„¶å­˜åœ¨æŒ‘æˆ˜ï¼š

- æ¯ä¸ªåº”ç”¨ä»éœ€è‡ªå»ºå‡½æ•°å®šä¹‰å’Œè°ƒç”¨é€»è¾‘
- ç¼ºä¹ç»Ÿä¸€çš„å·¥å…·ç”Ÿæ€å’Œå¤ç”¨æœºåˆ¶
- å¼€å‘è€…éœ€è¦å¤„ç†å¤æ‚çš„çŠ¶æ€ç®¡ç†å’Œé”™è¯¯å¤„ç†

è¿™ä¸ºåç»­ MCP ç­‰æ›´é«˜å±‚æ¬¡çš„æ ‡å‡†åŒ–åè®®å¥ å®šäº†åŸºç¡€ã€‚

### 2.5 MÃ—N é›†æˆéš¾é¢˜

åœ¨ MCP å‡ºç°ä¹‹å‰ï¼ŒAI å·¥å…·é›†æˆé¢ä¸´çš„æ ¸å¿ƒé—®é¢˜æ˜¯**ç¼ºä¹ç»Ÿä¸€æ ‡å‡†**ï¼Œå¯¼è‡´æ¯ä¸ª AI åº”ç”¨ä¸æ¯ä¸ªå·¥å…·ä¹‹é—´éƒ½éœ€è¦**ç‹¬ç«‹çš„å®šåˆ¶é›†æˆ**ã€‚

M ä¸ª AI åº”ç”¨ï¼ŒN ä¸ªå·¥å…·/æœåŠ¡ï¼Œæ¯ä¸ª AI åº”ç”¨éƒ½éœ€è¦ä¸ºæ¯ä¸ªå·¥å…·ç¼–å†™ä¸“é—¨çš„è¿æ¥ä»£ç ï¼Œç»“æœæ˜¯ **M Ã— N ä¸ªç‹¬ç«‹é›†æˆ**ï¼Œå½¢æˆ"æ„å¤§åˆ©é¢æ¡å¼"çš„æ··ä¹±è¿æ¥ã€‚

---

## 3 MCPï¼šæ¨¡å‹ä¸Šä¸‹æ–‡åè®®

### 3.1 MCP æ˜¯ä»€ä¹ˆï¼Ÿ

MCP æ˜¯ä¸€ç§**æ ‡å‡†åŒ–åè®®**ï¼Œå……å½“ AI æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·ä¹‹é—´çš„"é€šç”¨ç¿»è¯‘å™¨"ã€‚å°±åƒ USB-C ç»Ÿä¸€äº†è®¾å¤‡è¿æ¥æ ‡å‡†ä¸€æ ·ï¼ŒMCP ç»Ÿä¸€äº† AI å·¥å…·é›†æˆæ ‡å‡†ï¼Œä½¿ AI æ¨¡å‹èƒ½å¤Ÿæ— ç¼åœ°ä¸å¤–éƒ¨å·¥å…·ã€èµ„æºå’Œç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚

è§£å†³äº† MÃ—N é›†æˆå¤æ‚æ€§é—®é¢˜ï¼š

- **ä¼ ç»Ÿæ–¹å¼**ï¼šæ¯ä¸ª AI åº”ç”¨éœ€è¦ä¸ºæ¯ä¸ªå·¥å…·ç¼–å†™ç‹¬ç«‹çš„é›†æˆä»£ç 
- **MCP æ–¹å¼**ï¼šM ä¸ª AI åº”ç”¨ + N ä¸ªå·¥å…· = M+N æ¬¡å®ç°ï¼ˆè€Œé MÃ—Nï¼‰

![image.png](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/20250621111133.png)

### 3.2 MCP çš„ä¼˜åŠ¿

- **åŠ¨æ€èƒ½åŠ›å‘ç°**ï¼šä¼ ç»Ÿ AI ç³»ç»Ÿåªèƒ½ä½¿ç”¨é¢„å…ˆç¡¬ç¼–ç çš„å·¥å…·é›†ï¼Œæ·»åŠ æ–°åŠŸèƒ½éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç å¹¶é‡æ–°éƒ¨ç½²ã€‚MCP åˆ™å…è®¸ AI åœ¨è¿è¡Œæ—¶ä¸»åŠ¨æŸ¥è¯¢æœåŠ¡å™¨ç«¯å¯ç”¨çš„åŠŸèƒ½å’Œå·¥å…·ï¼Œå°±åƒæ™ºèƒ½åŠ©æ‰‹èƒ½å¤Ÿå®æ—¶äº†è§£å‘¨å›´ç¯å¢ƒä¸­çš„å¯ç”¨èµ„æºã€‚è¿™ç§èƒ½åŠ›å®ç°äº†çœŸæ­£çš„å³æ’å³ç”¨ï¼šå½“æ–°å·¥å…·æ·»åŠ åˆ° MCP æœåŠ¡å™¨æ—¶ï¼Œæ‰€æœ‰è¿æ¥çš„ AI å®¢æˆ·ç«¯éƒ½èƒ½ç«‹å³å‘ç°å¹¶ä½¿ç”¨è¿™äº›æ–°èƒ½åŠ›ï¼Œæ— éœ€ä»»ä½•ä»£ç ä¿®æ”¹ã€‚
- **æœ‰çŠ¶æ€äº¤äº’ä¸è®°å¿†**ï¼šä¼ ç»Ÿ API è°ƒç”¨æ˜¯æ— çŠ¶æ€çš„ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ç‹¬ç«‹å¤„ç†ï¼Œæ— æ³•ç»´æŠ¤ä¸Šä¸‹æ–‡ã€‚MCP èƒ½å¤Ÿåœ¨æ•´ä¸ªä¼šè¯æœŸé—´ç»´æŠ¤ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå°±åƒäººç±»å¯¹è¯ä¸­è®°ä½ä¹‹å‰çš„è®¨è®ºå†…å®¹ã€‚è¿™ä½¿å¾— AI å¯ä»¥ç¼“å­˜æŸ¥è¯¢ç»“æœé¿å…é‡å¤è®¡ç®—ï¼Œé‡ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯ä¼˜åŒ–åç»­æ“ä½œï¼Œå¹¶åœ¨å¤æ‚ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­è¿½è¸ªä¸­é—´çŠ¶æ€ã€‚ä¾‹å¦‚åœ¨å¤šæ­¥éª¤æ•°æ®åˆ†æä¸­ï¼ŒAI èƒ½è®°ä½æ¯ä¸ªæ­¥éª¤çš„ç»“æœå¹¶åœ¨åç»­æ­¥éª¤ä¸­å¼•ç”¨ã€‚
- **å¤šæ­¥ç¼–æ’ä¸æ™ºèƒ½å†³ç­–**ï¼šMCP ä½¿ AI èƒ½å¤Ÿåƒé¡¹ç›®ç»ç†ä¸€æ ·åè°ƒæ‰§è¡Œå¤æ‚å·¥ä½œæµç¨‹ï¼Œæ”¯æŒæ¡ä»¶é€»è¾‘åˆ¤æ–­ã€å¾ªç¯æ§åˆ¶å’Œå¤šå·¥å…·ç²¾å¯†åè°ƒã€‚AI å¯ä»¥æ ¹æ®ä¸­é—´ç»“æœåŠ¨æ€è°ƒæ•´æ‰§è¡Œè·¯å¾„ï¼Œå¤„ç†å¼‚å¸¸æƒ…å†µï¼Œç”šè‡³å¹¶è¡Œæ‰§è¡Œä»»åŠ¡æé«˜æ•ˆç‡ã€‚ä¾‹å¦‚å¤„ç†å®¢æˆ·æœåŠ¡è¯·æ±‚æ—¶ï¼ŒAI å¯ä»¥å…ˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œæ ¹æ®ç”¨æˆ·ç±»å‹è°ƒç”¨ä¸åŒå¤„ç†æµç¨‹ï¼ŒåŒæ—¶è®°å½•æ—¥å¿—å¹¶å‘é€é€šçŸ¥ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯æ§ä¸”å¯è¿½è¸ªã€‚
- **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šMCP é‡‡ç”¨å®¢æˆ·ç«¯ - æœåŠ¡å™¨æ¶æ„ï¼Œå®ç°æ¸…æ™°çš„èŒè´£åˆ†ç¦»ã€‚AI å®¢æˆ·ç«¯ä¸“æ³¨äºç†è§£ç”¨æˆ·æ„å›¾ã€åˆ¶å®šæ‰§è¡Œç­–ç•¥å’Œæ™ºèƒ½å†³ç­–ï¼Œæ— éœ€å…³å¿ƒå…·ä½“å·¥å…·å®ç°ç»†èŠ‚ã€‚MCP æœåŠ¡å™¨ä¸“æ³¨äºå·¥å…·çš„å…·ä½“æ‰§è¡Œé€»è¾‘ï¼ŒåŒ…æ‹¬å‚æ•°éªŒè¯ã€é”™è¯¯å¤„ç†ç­‰æŠ€æœ¯ç»†èŠ‚ã€‚è¿™ç§åˆ†ç¦»ä½¿å¾— AI å¼€å‘è€…å’Œå·¥å…·å¼€å‘è€…å¯ä»¥ç‹¬ç«‹ä¸“æ³¨å„è‡ªé¢†åŸŸï¼Œç³»ç»Ÿæ›´æ˜“ç»´æŠ¤ã€æµ‹è¯•å’Œæ‰©å±•ã€‚
- **å®‰å…¨ä¸æ§åˆ¶**ï¼šåœ¨ AI ç³»ç»Ÿæ—¥ç›Šå¼ºå¤§çš„ä»Šå¤©ï¼Œå®‰å…¨æ§åˆ¶å˜å¾—è‡³å…³é‡è¦ï¼ŒMCP åœ¨è¿™æ–¹é¢æä¾›äº†å¤šå±‚æ¬¡çš„ä¿æŠ¤æœºåˆ¶ã€‚é€šè¿‡é›†ä¸­åŒ–çš„å®‰å…¨æ£€æŸ¥ç‚¹ï¼ŒMCP å¯ä»¥åœ¨å·¥å…·æ‰§è¡Œå‰è¿›è¡Œç»Ÿä¸€çš„å®‰å…¨å®¡æŸ¥ï¼ŒåŒ…æ‹¬æƒé™éªŒè¯ã€å‚æ•°æ ¡éªŒã€æ“ä½œé£é™©è¯„ä¼°ç­‰ã€‚å¯¹äºå¯èƒ½äº§ç”Ÿé‡å¤§å½±å“çš„æ•æ„Ÿæ“ä½œï¼Œå¦‚åˆ é™¤æ–‡ä»¶ã€å‘é€é‚®ä»¶ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ç­‰ï¼ŒMCP å¯ä»¥è¦æ±‚ç”¨æˆ·è¿›è¡Œæ˜ç¡®ç¡®è®¤ï¼Œç¡®ä¿äººç±»å§‹ç»ˆä¿æŒå¯¹å…³é”®å†³ç­–çš„æ§åˆ¶æƒã€‚æ­¤å¤–ï¼ŒMCP è¿˜æ”¯æŒç»†ç²’åº¦çš„æƒé™ç®¡ç†ï¼Œå¯ä»¥ä¸ºä¸åŒçš„ AI å®¢æˆ·ç«¯æˆ–ä¸åŒçš„ä½¿ç”¨åœºæ™¯é…ç½®ä¸åŒçš„æƒé™çº§åˆ«ã€‚è¿™ç§å¤šå±‚æ¬¡çš„å®‰å…¨æœºåˆ¶ä¸ä»…ä¿æŠ¤äº†ç”¨æˆ·æ•°æ®å’Œç³»ç»Ÿå®‰å…¨ï¼Œè¿˜ä¸º AI ç³»ç»Ÿåœ¨ä¼ä¸šç¯å¢ƒä¸­çš„éƒ¨ç½²æä¾›äº†å¿…è¦çš„åˆè§„ä¿éšœï¼Œä½¿å¾—ç»„ç»‡èƒ½å¤Ÿæ”¾å¿ƒåœ°ä½¿ç”¨ AI æŠ€æœ¯æ¥å¤„ç†æ•æ„Ÿä¸šåŠ¡æµç¨‹ã€‚

---

## 4 MCP æ¶æ„è¯¦è§£

### 4.1 ä¸‰å¤§æ ¸å¿ƒè§’è‰²

| è§’è‰²   | å®šä½         | ä¸»è¦èŒè´£                   | ä¸¾ä¾‹                      |
|------|------------|-------------------------|------------------------|
| Host | ç”¨æˆ·ä¾§åº”ç”¨      | ç®¡ç†ç”¨æˆ·è¾“å…¥è¾“å‡ºã€ä¼šè¯çŠ¶æ€ã€å†³å®šä½•æ—¶è°ƒç”¨å¤–éƒ¨èƒ½åŠ› | Claude Desktopã€Cursorã€å®šåˆ¶ AI åŠ©æ‰‹ç­‰ |
| Client | Host å†…éƒ¨ç»„ä»¶ | å…·ä½“è´Ÿè´£ä¸ MCP Server æŒ‰åè®®é€šä¿¡ï¼Œè½¬å‘è¯·æ±‚ä¸å“åº” | SDKã€é€‚é…å±‚              |
| Server | èƒ½åŠ›æä¾›æ–¹    | æš´éœ²å·¥å…·/èµ„æº/æç¤ºè¯ï¼ŒæŒ‰åè®®å“åº”è°ƒç”¨è¯·æ±‚      | æœ¬åœ°/è¿œç¨‹å·¥å…·æœåŠ¡å™¨ã€API å°è£…ç­‰     |

Host æ˜¯ç”¨æˆ·ç›´æ¥äº¤äº’çš„ AI åº”ç”¨ç¨‹åºï¼Œå¦‚ Claude Desktopã€Cursor æˆ–è‡ªå®šä¹‰èŠå¤©åº”ç”¨ã€‚å®ƒæ‰¿æ‹…ç€æ•´ä¸ªç³»ç»Ÿçš„å†³ç­–å’Œåè°ƒè´£ä»»ï¼š

- **ç”¨æˆ·ç•Œé¢ç®¡ç†**ï¼šå¤„ç†ç”¨æˆ·è¾“å…¥è¾“å‡ºï¼Œç»´æŠ¤ä¼šè¯çŠ¶æ€
- **æ™ºèƒ½å†³ç­–**ï¼šæ ¹æ® AI æ„å›¾å†³å®šä½•æ—¶è°ƒç”¨å“ªäº›å¤–éƒ¨èƒ½åŠ›
- **è¿æ¥ç®¡ç†**ï¼šä¸»åŠ¨å‘èµ·ä¸ MCP æœåŠ¡å™¨çš„è¿æ¥
- **å·¥ä½œæµç¼–æ’**ï¼šåè°ƒ AI æ¨¡å‹ä¸å¤–éƒ¨å·¥å…·é—´çš„å¤æ‚äº¤äº’

Client æ˜¯ Host å†…éƒ¨çš„é€šä¿¡ç»„ä»¶ï¼Œè´Ÿè´£ä¸ MCP æœåŠ¡å™¨çš„åº•å±‚åè®®äº¤äº’ã€‚æ¯ä¸ª Client ä¸ä¸€ä¸ªæœåŠ¡å™¨å»ºç«‹ 1:1 è¿æ¥ï¼š

- **åè®®é©±åŠ¨**ï¼šå¤„ç† MCP è¯·æ±‚å‘é€å’Œå“åº”æ¥æ”¶
- **è¿æ¥ç»´æŠ¤**ï¼šç®¡ç†ç½‘ç»œè¿æ¥ã€é”™è¯¯å¤„ç†å’Œè¶…æ—¶æ§åˆ¶
- **åè®®åˆè§„**ï¼šç¡®ä¿ä¸¥æ ¼éµå¾ª MCP åè®®è§„èŒƒ
- **å¤šå®ä¾‹æ”¯æŒ**ï¼šHost å¯åˆ›å»ºå¤šä¸ª Client å®ä¾‹è¿æ¥ä¸åŒæœåŠ¡å™¨

Server æ˜¯å®é™…æä¾›å…·ä½“åŠŸèƒ½çš„å¤–éƒ¨ç¨‹åºï¼Œå¯æœ¬åœ°æˆ–è¿œç¨‹éƒ¨ç½²ï¼š

- **èƒ½åŠ›å°è£…**ï¼šå°†å„ç§åŠŸèƒ½ï¼ˆå·¥å…·ã€æ•°æ®ã€APIï¼‰æ ‡å‡†åŒ–æš´éœ²
- **æ ‡å‡†æ¥å£**ï¼šä»¥ç»Ÿä¸€æ ¼å¼æè¿°å¯ç”¨å·¥å…·å’Œèµ„æº
- **è¯·æ±‚æ‰§è¡Œ**ï¼šæ¥æ”¶å¹¶æ‰§è¡Œæ¥è‡ªå®¢æˆ·ç«¯çš„å…·ä½“æ“ä½œè¯·æ±‚
- **ç»“æœè¿”å›**ï¼šå°†æ‰§è¡Œç»“æœæŒ‰åè®®æ ¼å¼è¿”å›ç»™å®¢æˆ·ç«¯

### 4.2 é€šä¿¡æµç¨‹

1. **ç”¨æˆ·å‘èµ·è¯·æ±‚**
    ç”¨æˆ·é€šè¿‡ Host åº”ç”¨ç•Œé¢æå‡ºéœ€æ±‚ï¼Œå¦‚"æŸ¥è¯¢æ—§é‡‘å±±å¤©æ°”"ã€‚Host ä½¿ç”¨ LLM è§£ææ„å›¾ï¼Œè¯†åˆ«éœ€è¦å¤–éƒ¨å·¥å…·æ”¯æŒã€‚
2. **æœåŠ¡å™¨è¿æ¥ä¸å‘ç°**
    - Host ç¡®å®šéœ€è¦çš„æœåŠ¡å™¨ç±»å‹ï¼ˆå¦‚å¤©æ°”æœåŠ¡å™¨ï¼‰
    - æŒ‡ç¤ºå¯¹åº”çš„ Client å»ºç«‹è¿æ¥ï¼ˆæœ¬åœ°å¯åŠ¨è¿›ç¨‹æˆ–è¿œç¨‹ç½‘ç»œè¿æ¥ï¼‰
    - Client å‘é€æ ‡å‡†æŸ¥è¯¢è¯·æ±‚ï¼ˆ`tools/list`ã€`resources/list`ï¼‰
    - Server è¿”å›å¯ç”¨èƒ½åŠ›çš„è¯¦ç»†æè¿°ï¼ˆå·¥å…·åç§°ã€å‚æ•°ã€åŠŸèƒ½è¯´æ˜ï¼‰
3. **å·¥å…·è°ƒç”¨æ‰§è¡Œ**
    - Host åŸºäºèƒ½åŠ›å‘ç°ç»“æœåšå‡ºå…·ä½“è°ƒç”¨å†³ç­–
    - Client å‘é€æ ¼å¼åŒ–çš„å·¥å…·è°ƒç”¨è¯·æ±‚ï¼ˆå¦‚Â `get_weather(location='San Francisco')`ï¼‰
    - Server æ‰§è¡Œåº•å±‚é€»è¾‘ï¼ˆè°ƒç”¨å¤©æ°” APIã€æŸ¥è¯¢æ•°æ®åº“ç­‰ï¼‰
    - Server å°†æ‰§è¡Œç»“æœå°è£…ä¸ºæ ‡å‡†å“åº”è¿”å›
4. **ç»“æœé›†æˆä¸å±•ç¤º**
    - Client å°†æœåŠ¡å™¨å“åº”ä¼ é€’ç»™ Host
    - Host å°†ç»“æœæ•´åˆåˆ° AI æ¨¡å‹ä¸Šä¸‹æ–‡ä¸­
    - AI æ¨¡å‹åŸºäºå·¥å…·è¿”å›çš„æ•°æ®ç”Ÿæˆç”¨æˆ·å‹å¥½çš„å›ç­”
    - Host é€šè¿‡ç•Œé¢å‘ç”¨æˆ·å±•ç¤ºæœ€ç»ˆç»“æœ
5. **ä¼šè¯ç®¡ç†ä¸ç»ˆæ­¢**
    - æ”¯æŒå¤šè½®äº¤äº’å’Œå¤šæœåŠ¡å™¨å¹¶å‘è°ƒç”¨
    - ç»´æŠ¤ä¼šè¯çŠ¶æ€å’Œä¸Šä¸‹æ–‡è¿ç»­æ€§
    - ä¼šè¯ç»“æŸæ—¶ä¼˜é›…å…³é—­è¿æ¥ï¼Œæ¸…ç†èµ„æº

> **ä¼˜åŠ¿**ï¼šè¿™ç§ä¸‰å±‚åˆ†ç¦»çš„æ¶æ„è®¾è®¡å®ç°äº†ï¼š
> - **æ¨¡å—åŒ–æ‰©å±•**ï¼šæ–°å·¥å…·æ— éœ€ä¿®æ”¹ AI åº”ç”¨ï¼Œåªéœ€éƒ¨ç½²æ–°æœåŠ¡å™¨
> - **åè®®æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„é€šä¿¡åè®®ç¡®ä¿äº’æ“ä½œæ€§
> - **èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªè§’è‰²ä¸“æ³¨è‡ªèº«æ ¸å¿ƒåŠŸèƒ½ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦
> - **çµæ´»éƒ¨ç½²**ï¼šæ”¯æŒæœ¬åœ°å’Œè¿œç¨‹æœåŠ¡å™¨çš„æ··åˆæ¶æ„

---

## 5 MCP èƒ½åŠ›ä½“ç³»ï¼ˆCapabilitiesï¼‰

MCP Server å¯ä»¥å‘ Client æš´éœ²å¤šç§èƒ½åŠ›ï¼Œåˆ†ä¸ºå››å¤§ç±»ï¼š

### 5.1 Toolsï¼ˆå·¥å…·/æ“ä½œï¼‰

Tools æ˜¯ MCP ä¸­æœ€æ´»è·ƒçš„èƒ½åŠ›ç±»å‹ï¼Œä»£è¡¨å…·å¤‡æ‰§è¡Œèƒ½åŠ›çš„å‡½æ•°æˆ–åŠ¨ä½œã€‚å®ƒä»¬é€šå¸¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œèƒ½å¤Ÿæ”¹å˜å¤–éƒ¨ç³»ç»ŸçŠ¶æ€æˆ–è§¦å‘å®é™…æ“ä½œã€‚æ™ºèƒ½è°ƒç”¨æœºåˆ¶å¦‚ä¸‹ï¼š

- **è‡ªä¸»è§¦å‘**ï¼šLLM é€šè¿‡ Host æ ¹æ®å¯¹è¯ä¸Šä¸‹æ–‡å’Œç”¨æˆ·æ„å›¾è‡ªä¸»å†³å®šè°ƒç”¨æ—¶æœº
- **å‚æ•°ä¼ é€’**ï¼šæ”¯æŒå¤æ‚çš„å‚æ•°ç»“æ„ï¼ŒåŒ…æ‹¬å¿…éœ€å‚æ•°å’Œå¯é€‰å‚æ•°
- **é“¾å¼è°ƒç”¨**ï¼šæ”¯æŒå¤šä¸ªå·¥å…·çš„é¡ºåºæˆ–å¹¶è¡Œè°ƒç”¨ï¼Œå½¢æˆå¤æ‚å·¥ä½œæµ

```python
@mcp.tool() 
def send_email(recipient: str, subject: str, body: str): """å‘é€é‚®ä»¶ - éœ€è¦ç”¨æˆ·ç¡®è®¤çš„é«˜é£é™©æ“ä½œ""" 
return email_service.send(recipient, subject, body)
```

### 5.2 Resourcesï¼ˆèµ„æºï¼‰

Resources æä¾›åªè¯»çš„æ•°æ®è®¿é—®èƒ½åŠ›ï¼Œä¸“æ³¨äºä¿¡æ¯æ£€ç´¢è€Œéæ“ä½œæ‰§è¡Œã€‚è¿™ç§è®¾è®¡ç¡®ä¿äº†æ•°æ®å®‰å…¨æ€§ï¼Œé¿å…æ„å¤–çš„æ•°æ®ä¿®æ”¹ã€‚æ™ºèƒ½æ£€ç´¢æœºåˆ¶ï¼š

- **è¯­ä¹‰æœç´¢**ï¼šåŸºäºå†…å®¹ç†è§£çš„æ™ºèƒ½æ£€ç´¢
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šæ ¹æ®å¯¹è¯å†å²ä¼˜åŒ–æ£€ç´¢ç»“æœ
- **å¢é‡æ›´æ–°**ï¼šæ”¯æŒèµ„æºå†…å®¹çš„åŠ¨æ€æ›´æ–°å’Œç‰ˆæœ¬ç®¡ç†
- **ç¼“å­˜ä¼˜åŒ–**ï¼šæ™ºèƒ½ç¼“å­˜ç­–ç•¥å‡å°‘é‡å¤è®¿é—®å¼€é”€

```Python
@mcp.resource("database/users") 
def query_user_data(filters: dict): 
"""ç”¨æˆ·æ•°æ®æŸ¥è¯¢""" 
return sanitized_user_data
```

### 5.3 Promptsï¼ˆæç¤ºè¯/æ¨¡æ¿ï¼‰

Prompts æä¾›é¢„å®šä¹‰çš„å¯¹è¯æ¨¡æ¿å’Œ**è¡Œä¸ºå¼•å¯¼**ï¼Œå¸®åŠ© AI åœ¨ç‰¹å®šåœºæ™¯ä¸‹è¡¨ç°å‡ºæœŸæœ›çš„è¡Œä¸ºæ¨¡å¼ã€‚è¿™ç§èƒ½åŠ›ç‰¹åˆ«é€‚åˆæ ‡å‡†åŒ–çš„ä¸šåŠ¡æµç¨‹å’Œä¸“ä¸šé¢†åŸŸåº”ç”¨ã€‚å…¶æ™ºèƒ½é€‚é…æœºåˆ¶å¦‚ä¸‹ï¼š

- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šæ ¹æ®å½“å‰å¯¹è¯çŠ¶æ€è°ƒæ•´æ¨¡æ¿å†…å®¹
- **ä¸ªæ€§åŒ–å®šåˆ¶**ï¼šåŸºäºç”¨æˆ·å†å²äº¤äº’ä¼˜åŒ–æç¤ºç­–ç•¥
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šè‡ªåŠ¨é€‚é…ä¸åŒè¯­è¨€ç¯å¢ƒçš„æç¤ºæ¨¡æ¿
- **A/B æµ‹è¯•**ï¼šæ”¯æŒå¤šç‰ˆæœ¬æ¨¡æ¿çš„æ•ˆæœå¯¹æ¯”

```python
@mcp.prompt("code_review")
def code_review_prompt(language: str, complexity: str):
    """ä»£ç å®¡æŸ¥æç¤ºæ¨¡æ¿"""
    return {
        "role": "èµ„æ·±ä»£ç å®¡æŸ¥ä¸“å®¶",
        "context": f"å®¡æŸ¥ {language} ä»£ç ï¼Œå¤æ‚åº¦ï¼š{complexity}",
        "checklist": ["å®‰å…¨æ€§", "æ€§èƒ½", "å¯ç»´æŠ¤æ€§", "æœ€ä½³å®è·µ"],
        "output_format": "ç»“æ„åŒ–åé¦ˆæŠ¥å‘Š"
    }
```

### 5.4 Samplingï¼ˆé‡‡æ ·ï¼‰

Sampling æ˜¯ MCP çš„é«˜çº§èƒ½åŠ›ï¼Œå…è®¸æœåŠ¡ç«¯è¯·æ±‚ AI æ‰§è¡Œå¤æ‚çš„è®¤çŸ¥ä»»åŠ¡ï¼Œå®ç°å¤šæ­¥æ¨ç†å’Œè‡ªæˆ‘åæ€ï¼Œå®ç°è®¤çŸ¥èƒ½åŠ›æ‰©å±•ï¼š

- **å¤šæ­¥æ¨ç†**ï¼šåˆ†è§£å¤æ‚é—®é¢˜ï¼Œé€æ­¥æ±‚è§£
- **è‡ªæˆ‘åæ€**ï¼šè¯„ä¼°ç­”æ¡ˆè´¨é‡ï¼Œè‡ªæˆ‘çº é”™
- **åˆ›æ„ç”Ÿæˆ**ï¼šå¤´è„‘é£æš´ã€æ–¹æ¡ˆè®¾è®¡ã€åˆ›æ–°æ€ç»´
- **å†³ç­–åˆ†æ**ï¼šæƒè¡¡åˆ©å¼Šã€é£é™©è¯„ä¼°ã€æœ€ä¼˜é€‰æ‹©

### 5.5 èƒ½åŠ›ååŒä½“ç³»

- **å·¥å…·é“¾é›†æˆ**ï¼šå¤šä¸ª Tools å½¢æˆå®Œæ•´çš„ä¸šåŠ¡æµç¨‹
- **èµ„æºé©±åŠ¨å†³ç­–**ï¼šåŸºäº Resources æ•°æ®è°ƒç”¨ç›¸åº” Tools
- **æ¨¡æ¿å¼•å¯¼æ‰§è¡Œ**ï¼šä½¿ç”¨ Prompts ä¼˜åŒ– Tools çš„æ‰§è¡Œæ•ˆæœ
- **é‡‡æ ·å¢å¼ºæ™ºèƒ½**ï¼šé€šè¿‡ Sampling æå‡æ•´ä½“å†³ç­–è´¨é‡

---

## 6 MCP é€šä¿¡åè®®è¯¦è§£

MCPï¼ˆModel Context Protocolï¼‰é‡‡ç”¨åŸºäº **JSON-RPC 2.0** çš„é€šä¿¡æ¶æ„ï¼Œå®ç°äº†å®¢æˆ·ç«¯ã€ä¸»æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ ‡å‡†åŒ–äº¤äº’ã€‚è¿™ç§è®¾è®¡é€‰æ‹©ä½“ç°äº†ä»¥ä¸‹æ ¸å¿ƒç†å¿µï¼š

- **ç®€æ´æ€§**ï¼šJSON-RPC 2.0 æä¾›äº†æœ€å°åŒ–ä½†å®Œæ•´çš„è¿œç¨‹è°ƒç”¨æœºåˆ¶
- **äº’æ“ä½œæ€§**ï¼šè·¨è¯­è¨€ã€è·¨å¹³å°çš„æ ‡å‡†åŒ–æ¥å£
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒå¤šç§ä¼ è¾“æ–¹å¼å’Œæ¶ˆæ¯æ¨¡å¼
- **å¯é æ€§**ï¼šæˆç†Ÿçš„åè®®åŸºç¡€ï¼Œç»è¿‡å¹¿æ³›éªŒè¯

### 6.1 åŸºç¡€åè®®ï¼šJSON-RPC 2.0

- **ä¼˜ç‚¹**ï¼šè½»é‡ã€è·¨è¯­è¨€ã€æ˜“è¯»ï¼Œå¹¿æ³›æ”¯æŒã€‚
- **æ¶ˆæ¯ç±»å‹**ï¼š
    - **Request**ï¼šå®¢æˆ·ç«¯å‘èµ·è°ƒç”¨ï¼ˆå¦‚ `tools/call`ã€`tools/list`ï¼‰ï¼Œå¸¦å”¯ä¸€Â `id`ã€`method`ã€`params` è¿™äº›å‚æ•°ã€‚
    - **Response**ï¼šæœåŠ¡ç«¯å“åº”ï¼ˆå¸¦åŒä¸€Â `id`ï¼‰ï¼Œè¿”å›Â `result`Â æˆ–Â `error`ã€‚
    - **Notification**ï¼šæœåŠ¡å™¨å•å‘é€šçŸ¥å®¢æˆ·ç«¯ï¼Œæ— éœ€å“åº”ï¼ˆå¦‚è¿›åº¦æ›´æ–°ã€å¼‚æ­¥äº‹ä»¶ï¼‰ã€‚

### 6.2 ä¼ è¾“æ–¹å¼

1. **Stdioï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºï¼‰**
    - **è¿›ç¨‹é—´é€šä¿¡**ï¼šåˆ©ç”¨æ“ä½œç³»ç»Ÿçš„æ ‡å‡†è¾“å…¥è¾“å‡ºæµ
    - **åŒæ­¥é€šä¿¡**ï¼šåŸºäºè¡Œç¼“å†²çš„ JSON æ¶ˆæ¯äº¤æ¢
    - **è¿›ç¨‹éš”ç¦»**ï¼šå¤©ç„¶çš„å®‰å…¨è¾¹ç•Œå’Œèµ„æºæ§åˆ¶
2. **HTTP + SSEï¼ˆServer-Sent Eventsï¼‰**
    - **HTTP è¯·æ±‚**ï¼šå®¢æˆ·ç«¯å‘é€ POST è¯·æ±‚æºå¸¦ JSON-RPC æ¶ˆæ¯
    - **SSE å“åº”**ï¼šæœåŠ¡å™¨é€šè¿‡ Server-Sent Events æµå¼è¿”å›æ•°æ®
    - **è¿æ¥å¤ç”¨**ï¼šæ”¯æŒé•¿è¿æ¥å’Œè¿æ¥æ± ç®¡ç†

---

## 7 MCP äº¤äº’ç”Ÿå‘½å‘¨æœŸ

1. **Initializationï¼ˆåˆå§‹åŒ–é˜¶æ®µï¼‰**
    - å®¢æˆ·ç«¯å‘é€Â `initialize request`Â ï¼Œåå•†åè®®ç‰ˆæœ¬ã€èº«ä»½ã€åå¥½ç­‰ã€‚
    - æœåŠ¡å™¨å“åº” `initialize response`ï¼Œç¡®è®¤è¿æ¥å¹¶è¯´æ˜å…¶æ”¯æŒçš„åè®®ç‰ˆæœ¬å’Œå¯èƒ½çš„æœåŠ¡å™¨ä¿¡æ¯ã€‚
    - æœåŠ¡ç«¯ç¡®è®¤åï¼Œå®¢æˆ·ç«¯å‘é€Â `initialized`Â é€šçŸ¥ï¼ŒåŒæ–¹å‡†å¤‡å°±ç»ªã€‚
2. **Discoveryï¼ˆèƒ½åŠ›å‘ç°é˜¶æ®µï¼‰**
    - å®¢æˆ·ç«¯ä¾æ¬¡è¯·æ±‚Â `tools/list`ã€`resources/list`ã€`prompts/list`Â ç­‰ï¼Œè·å–æ‰€æœ‰å¯ç”¨èƒ½åŠ›åŠå‚æ•°æè¿°ï¼Œä¾› LLM å†³ç­–è°ƒç”¨ã€‚
3. **Executionï¼ˆæ‰§è¡Œé˜¶æ®µï¼‰**
    - å®¢æˆ·ç«¯æ ¹æ®ç”¨æˆ·æ„å›¾å’Œèƒ½åŠ›æ¸…å•ï¼Œå‘èµ·å…·ä½“è°ƒç”¨ï¼ˆå¦‚Â `tools/call`ã€`resources/read`ï¼‰ã€‚
    - æœåŠ¡ç«¯æ‰§è¡Œå¹¶è¿”å›ç»“æœï¼ŒåŒæ—¶å¯é€šè¿‡ `notification` æ¨é€è¿›åº¦ã€äº‹ä»¶ç­‰å¼‚æ­¥ä¿¡æ¯ã€‚
4. **Terminationï¼ˆç»ˆæ­¢é˜¶æ®µï¼‰**
    - ä¼šè¯ç»“æŸæ—¶ï¼Œå®¢æˆ·ç«¯å‘é€Â `shutdown`Â è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ç¡®è®¤åå¯å‘é€Â `exit`Â é€šçŸ¥ï¼Œå®‰å…¨å…³é—­è¿æ¥å’Œèµ„æºã€‚

## 8 MCP vs. FC vs. API

>[!NOTE]
> **"æ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€ä¸ªä¸­é—´å±‚ä¸èƒ½è§£å†³çš„"**

|   ç»´åº¦    |    MCP    | Function Calling |    API     |
| :-----: | :-------: | :--------------: | :--------: |
| **å®šä½**  |  ç»Ÿä¸€èƒ½åŠ›åè®®   |     AI æ¨¡å‹ç‰¹æ€§      |    æœåŠ¡æ¥å£    |
| **å±‚çº§**  |   åè®®æ ‡å‡†å±‚   |      æ¨¡å‹èƒ½åŠ›å±‚       |   åº”ç”¨æœåŠ¡å±‚    |
| **ä½œç”¨åŸŸ** |   ç”Ÿæ€ç³»ç»Ÿ    |       å•ä¸€æ¨¡å‹       |    å•ä¸€æœåŠ¡    |
| **æœ¬è´¨**  | **æŠ½è±¡å±‚**Â âœ¨ |    **é€‚é…å±‚**Â ğŸ”„    | **å®ç°å±‚**Â âš™ï¸ |

MCP æ˜¯åè®®æ ‡å‡†ï¼ŒFunction Calling æ˜¯ AI èƒ½åŠ›ï¼ŒAPI æ˜¯æœåŠ¡æ¥å£ã€‚ä¸‰è€…å¤„äºä¸åŒå±‚æ¬¡ï¼Œå„æœ‰ä¼˜åŠ¿ï¼Œå¯ä»¥ååŒä½¿ç”¨ã€‚

## 9 Hands-on å®è·µ

æœ¬èŠ‚å°†é€šè¿‡ Python çš„ `fastmcp` åº“ï¼Œæ¼”ç¤ºå¦‚ä½•å¿«é€Ÿæ„å»ºä¸€ä¸ªéµå¾ªæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰çš„æœåŠ¡ã€‚ä»¥ä¸‹ç¤ºä¾‹ä»£ç å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„å¤©æ°”æœåŠ¡ï¼Œè¯¥æœåŠ¡åŒ…å«ä¸¤ä¸ªå·¥å…·ï¼ˆToolsï¼‰ï¼šä¸€ä¸ªç”¨äºè·å–åŸå¸‚ç»çº¬åº¦ï¼Œå¦ä¸€ä¸ªç”¨äºæŸ¥è¯¢è¯¥åœ°ç‚¹çš„å¤©æ°”ã€‚

```Python
from fastmcp import FastMCP

# åˆå§‹åŒ– FastMCP åº”ç”¨ï¼Œå¹¶å‘½åä¸º "Simple Weather Server"
mcp = FastMCP("Simple Weather Server")

@mcp.tool
def get_coordinates(city: str) -> dict:
    """
    æ ¹æ®åŸå¸‚åç§°è·å–å…¶åœ°ç†åæ ‡ï¼ˆç»çº¬åº¦ï¼‰ã€‚
    
    :param city: åŸå¸‚åç§°ï¼Œä¾‹å¦‚ "åŒ—äº¬"ã€‚
    :return: åŒ…å«åŸå¸‚åç§°ã€çº¬åº¦å’Œç»åº¦çš„å­—å…¸ã€‚
    """
    # æ³¨æ„ï¼šæ­¤å¤„ä¸ºæ¼”ç¤ºç›®çš„ï¼Œè¿”å›ç¡¬ç¼–ç çš„åæ ‡ã€‚
    # å®é™…åº”ç”¨ä¸­åº”è°ƒç”¨åœ°ç†ç¼–ç  APIã€‚
    return {"city": city, "latitude": 39.9042, "longitude": 116.4074}

@mcp.tool
def get_weather(latitude: float, longitude: float) -> dict:
    """
    æ ¹æ®ç»çº¬åº¦åæ ‡è·å–å¤©æ°”ä¿¡æ¯ã€‚
    
    :param latitude: çº¬åº¦ã€‚
    :param longitude: ç»åº¦ã€‚
    :return: åŒ…å«å¤©æ°”è¯¦æƒ…çš„å­—å…¸ã€‚
    """
    # æ³¨æ„ï¼šæ­¤å¤„ä¸ºæ¼”ç¤ºç›®çš„ï¼Œè¿”å›ç¡¬ç¼–ç çš„å¤©æ°”æ•°æ®ã€‚
    # å®é™…åº”ç”¨ä¸­åº”è°ƒç”¨å¤©æ°”æœåŠ¡ APIã€‚
    return {
        "latitude": latitude,
        "longitude": longitude,
        "temperature": 20.0,
        "condition": "Sunny"
    }

if __name__ == "__main__":
    # å¯åŠ¨ FastMCP æœåŠ¡å™¨ã€‚
    # ä¼ è¾“æ–¹å¼ (transport) å†³å®šäº†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„é€šä¿¡æœºåˆ¶ã€‚
    
    # æ–¹å¼ä¸€ï¼šStdio (æ ‡å‡†è¾“å…¥/è¾“å‡º)
    # mcp.run() 
    
    # æ–¹å¼äºŒï¼šSSE (Server-Sent Events)ï¼Œç›‘å¬äº 8080 ç«¯å£
    mcp.run(transport="sse", port=8080)
```

æœåŠ¡å¯åŠ¨åï¼Œå¯ä»¥é€šè¿‡å…¼å®¹ MCP çš„å®¢æˆ·ç«¯ï¼ˆå¦‚ CherryStudio, Cursorï¼‰æˆ–å®˜æ–¹è°ƒè¯•å·¥å…·ä¸å…¶äº¤äº’ã€‚å®˜æ–¹è°ƒè¯•å™¨ï¼ˆMCP Inspectorï¼‰å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ï¼š

```shell
npx -y @modelcontextprotocol/inspector
```

å¯åŠ¨åï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:6274/`ï¼Œå¹¶é™„ä¸Šè®¤è¯ä»¤ç‰Œã€‚

> **é‡è¦æç¤º** è®¿é—®è°ƒè¯•å™¨æ—¶ï¼Œå¿…é¡»æºå¸¦ `MCP_PROXY_AUTH_TOKEN` å‚æ•°ï¼Œå…¶å€¼å¯åœ¨ MCP æœåŠ¡å™¨å¯åŠ¨æ—¶çš„ç»ˆç«¯è¾“å‡ºä¸­æ‰¾åˆ°ã€‚ ç¤ºä¾‹ URL: `http://localhost:6274/?MCP_PROXY_AUTH_TOKEN=your_token_here`

![MCP Inspector](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/Pasted%20image%2020250630152955.png)

ä¸ºäº†æ·±å…¥ç†è§£ MCP çš„å·¥ä½œæœºåˆ¶ï¼Œæˆ‘åŸºäºä»£ç†æ•è·æ‰€æœ‰çš„é€šä¿¡æ—¥å¿—å¹¶åˆ†æäº†åŸºäº SSE çš„é€šä¿¡å…¨è¿‡ç¨‹ã€‚å…¶æ ¸å¿ƒåœ¨äºä¸€ä¸ªä¸¤é˜¶æ®µçš„è¿æ¥å»ºç«‹è¿‡ç¨‹ï¼šé¦–å…ˆé€šè¿‡åˆå§‹ SSE ç«¯ç‚¹è·å–ä¸€ä¸ªåŠ¨æ€çš„ã€å¸¦ä¼šè¯ ID çš„é€šä¿¡ç«¯ç‚¹ï¼Œç„¶åæ‰€æœ‰åç»­ä¸šåŠ¡äº¤äº’éƒ½åœ¨è¿™ä¸ªæ–°ç«¯ç‚¹ä¸Šè¿›è¡Œã€‚

è¯¦ç»†æµç¨‹åˆ†è§£å¦‚ä¸‹ï¼š

1. **å»ºç«‹ SSE è¿æ¥**: å®¢æˆ·ç«¯å‘åˆå§‹ç«¯ç‚¹ï¼ˆä¾‹å¦‚ `http://localhost:8080/sse/`ï¼‰å‘èµ·ä¸€ä¸ª HTTP GET è¯·æ±‚ã€‚è¯·æ±‚å¤´ä¸­å¿…é¡»åŒ…å« `Accept: text/event-stream`ï¼Œä»¥è¡¨æ˜å…¶æœŸæœ›å»ºç«‹ SSE è¿æ¥ã€‚æœåŠ¡å™¨ä»¥ `HTTP 200 OK` å“åº”ï¼Œä¿æŒè¿æ¥å¼€æ”¾ã€‚æ³¨æ„æ˜¯ `/sse/` å¦åˆ™ä¼šæœ‰ä¸€æ¬¡é‡å®šå‘ã€‚
2. **ç«¯ç‚¹å‘ç° (Endpoint Discovery)**: è¿æ¥å»ºç«‹åï¼ŒæœåŠ¡å™¨ç«‹å³é€šè¿‡ SSE æ¨é€ä¸€æ¡ `endpoint` äº‹ä»¶ï¼Œå…¶ `data` å­—æ®µåŒ…å«äº†ç”¨äºåç»­é€šä¿¡çš„ã€å”¯ä¸€çš„ä¼šè¯ç«¯ç‚¹ URLã€‚

    ```txt
    event: endpoint 
    data: /messages/?session_id=xxx
    ```

    æ­¤æ­¥éª¤å°†é€šä¿¡å¼•å¯¼è‡³ä¸€ä¸ªä¸“ç”¨çš„ã€å…·æœ‰ä¼šè¯éš”ç¦»èƒ½åŠ›çš„è·¯å¾„ã€‚

3. **åˆå§‹åŒ–è¯·æ±‚ (Initialize)**: å®¢æˆ·ç«¯å‘æ­¥éª¤ 2 ä¸­è·å–åˆ°çš„æ–°ç«¯ç‚¹ï¼ˆ`/messages/?session_id=...`ï¼‰å‘é€ä¸€ä¸ª HTTP POST è¯·æ±‚ï¼Œè¯·æ±‚ä½“ä¸º JSON-RPC æ ¼å¼ï¼Œ`method` ä¸º `initialize`ã€‚
4. **åˆå§‹åŒ–å“åº”**: æœåŠ¡å™¨æ¥æ”¶åˆ°åˆå§‹åŒ–è¯·æ±‚åï¼Œä¼šç«‹å³ä»¥ `HTTP 202 Accepted` çŠ¶æ€ç å…³é—­è¯¥ POST è¯·æ±‚ã€‚éšåï¼Œé€šè¿‡ä¹‹å‰å»ºç«‹çš„ SSE è¿æ¥æ¨é€åˆå§‹åŒ–ç»“æœã€‚è¿™é€šå¸¸åŒ…å«ä¸¤æ¡æ¶ˆæ¯ï¼šä¸€æ¡ `message` äº‹ä»¶é€šçŸ¥ï¼Œç´§æ¥ç€ä¸€æ¡ `data` äº‹ä»¶ï¼Œå…¶ä¸­åŒ…å«å…·ä½“çš„åˆå§‹åŒ–æ•°æ®ï¼ˆå¦‚æœåŠ¡å™¨èƒ½åŠ›ã€å¯ç”¨å·¥å…·åˆ—è¡¨ç­‰ï¼‰ã€‚
5. **åˆå§‹åŒ–ç¡®è®¤ (Initialized Notification)**: å®¢æˆ·ç«¯åœ¨æˆåŠŸå¤„ç†åˆå§‹åŒ–ä¿¡æ¯åï¼Œä¼šå†æ¬¡å‘ä¼šè¯ç«¯ç‚¹å‘é€ä¸€ä¸ª POST è¯·æ±‚ï¼Œè¯·æ±‚ä½“ä¸º `{"method":"notifications/initialized","jsonrpc":"2.0"}`ï¼Œä»¥æ­¤é€šçŸ¥æœåŠ¡å™¨å®¢æˆ·ç«¯å·²å‡†å¤‡å°±ç»ªã€‚
6. **åç»­é€šä¿¡**: æ­¤åçš„æ‰€æœ‰äº¤äº’ï¼Œä¾‹å¦‚åˆ—å‡ºå®¢è°ƒç”¨å·¥å…·ï¼ˆTool Callsï¼‰ï¼Œéƒ½å°†éµå¾ªç±»ä¼¼çš„ `POST è¯·æ±‚ -> SSE å“åº”` æ¨¡å¼ï¼Œåœ¨åŒä¸€ä¸ªä¼šè¯ç«¯ç‚¹ä¸Šè¿›è¡Œã€‚

> **æ ¸å¿ƒé—®é¢˜**ï¼šåœ¨å°† MCP æœåŠ¡éƒ¨ç½²äºåå‘ä»£ç†ï¼ˆå¦‚ NGINX Ingressï¼‰ä¹‹åï¼Œä¸€ä¸ªå¸¸è§çš„æŒ‘æˆ˜æºäºä¸Šè¿°çš„"ç«¯ç‚¹å‘ç°"æœºåˆ¶ã€‚æœåŠ¡å™¨åœ¨å“åº”ä½“ä¸­åŠ¨æ€ä¸‹å‘çš„ä¼šè¯ç«¯ç‚¹ URLï¼ˆå¦‚ `/messages/?â€¦`ï¼‰æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œåå‘ä»£ç†é»˜è®¤ä¸ä¼šé‡å†™å“åº”ä½“ä¸­çš„å†…å®¹ã€‚è¿™å¯¼è‡´å®¢æˆ·ç«¯æ”¶åˆ°çš„åœ°å€æ˜¯æœåŠ¡çš„å†…éƒ¨åœ°å€ï¼Œå¦‚æœä»£ç†é…ç½®äº†è·¯å¾„å‰ç¼€ï¼ˆPath Prefixï¼‰ï¼Œå®¢æˆ·ç«¯å°†æ— æ³•æ­£ç¡®è®¿é—®è¯¥ç«¯ç‚¹ï¼Œå¯¼è‡´é€šä¿¡å¤±è´¥ã€‚
> **è§£å†³æ–¹æ¡ˆ**ï¼š
> 1. **å“åº”ä½“å†…å®¹é‡å†™ (Response Body Rewriting)** åˆ©ç”¨åå‘ä»£ç†çš„é«˜çº§åŠŸèƒ½ï¼Œåœ¨å“åº”è¿”å›ç»™å®¢æˆ·ç«¯å‰ï¼ŒåŠ¨æ€æ›¿æ¢å“åº”ä½“ä¸­çš„ URLã€‚ä¾‹å¦‚ï¼Œ`NGINX Ingress Controller` çš„ `sub_filter` æŒ‡ä»¤å¯ä»¥å®ç°æ­¤åŠŸèƒ½ï¼Œå°†å†…éƒ¨è·¯å¾„æ›¿æ¢ä¸ºå¯å…¬å¼€è®¿é—®çš„å®Œæ•´è·¯å¾„ã€‚
> 2. **ä½¿ç”¨é«˜çº§ API ç½‘å…³æ’ä»¶ (Advanced API Gateway Plugins)** è®¸å¤šç°ä»£ API ç½‘å…³ï¼ˆå¦‚ Kong, APISIXï¼‰æä¾›æ’ä»¶æˆ–è„šæœ¬èƒ½åŠ›ï¼Œå¯ä»¥ç¼–å†™é€»è¾‘æ¥æ‹¦æˆªå’Œä¿®æ”¹å“åº”ä½“ï¼Œå®ç°æ›´çµæ´»çš„åœ°å€è½¬æ¢ã€‚
> 3. **ä¾èµ–è¯·æ±‚å¤´è¿›è¡ŒåŠ¨æ€è·¯å¾„æ„å»º (Recommended)** è¿™æ˜¯ä¸€ç§æ›´ä¼˜é›…çš„åç«¯è§£å†³æ–¹æ¡ˆã€‚è®©åç«¯åº”ç”¨æ„ŸçŸ¥å…¶ä»£ç†ç¯å¢ƒã€‚åœ¨åå‘ä»£ç†ä¸­é…ç½® `X-Forwarded-Prefix` æˆ–ç±»ä¼¼çš„æ ‡å‡†è¯·æ±‚å¤´ï¼Œå°†å…¬å¼€è®¿é—®çš„è·¯å¾„å‰ç¼€ä¼ é€’ç»™åç«¯ã€‚åç«¯ MCP æœåŠ¡åœ¨ç”Ÿæˆä¼šè¯ç«¯ç‚¹ URL æ—¶ï¼Œè¯»å–æ­¤è¯·æ±‚å¤´å¹¶å°†å…¶æ‹¼æ¥åˆ° URL çš„æœ€å‰ç«¯ã€‚è¿™ç§æ–¹å¼æ— éœ€ä¿®æ”¹ä»£ç†çš„å“åº”ï¼Œè€¦åˆåº¦æ›´ä½ã€‚

## 10 MCP å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å®ç°

æˆ‘ä»¬å¯ä»¥åŠ¨æ‰‹ç¼–ç¨‹å®ç°ä¸€ä¸ª MCP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯çš„æ ¸å¿ƒèŒè´£æ˜¯è¿æ¥ MCP æœåŠ¡å™¨ã€å¤„ç†ç”¨æˆ·æŸ¥è¯¢å¹¶åè°ƒ LLM ä¸å·¥å…·çš„äº¤äº’ã€‚

![image.png](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/20250621150033.png)

**å®ç°æµç¨‹ï¼š**

1. **å·¥å…·å‘ç°**Â - ä» MCP æœåŠ¡å™¨è·å–å¯ç”¨å·¥å…·åˆ—è¡¨
2. **æŸ¥è¯¢å¤„ç†**Â - å°†ç”¨æˆ·æŸ¥è¯¢å’Œå·¥å…·ä¿¡æ¯ä¸€èµ·å‘é€ç»™ LLM
3. **å·¥å…·è°ƒç”¨**Â - æ£€æµ‹å¹¶è§£æ LLM è¾“å‡ºä¸­çš„å·¥å…·è°ƒç”¨æŒ‡ä»¤
4. **ç»“æœæ•´åˆ**Â - æ‰§è¡Œå·¥å…·åå°†ç»“æœåé¦ˆç»™ LLM
5. **å¾ªç¯è¿­ä»£**Â - LLM æ ¹æ®å·¥å…·ç»“æœå†³å®šç»§ç»­è°ƒç”¨å·¥å…·æˆ–è¾“å‡ºæœ€ç»ˆç­”æ¡ˆ

è¿™ç§è®¾è®¡è®© LLM èƒ½å¤Ÿæ™ºèƒ½åœ°è¿›è¡Œå¤šè½®å·¥å…·è°ƒç”¨ï¼Œç›´åˆ°å®Œæˆå¤æ‚ä»»åŠ¡å¹¶ç»™å‡ºæœ€ç»ˆå“åº”ã€‚

## 11 MCP Resources & Prompts

### 11.1 Resources

åœ¨ MCPï¼ˆModel Context Protocolï¼‰æ¡†æ¶ä¸­ï¼Œ**Resources** æ˜¯ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€ï¼Œä¸“é—¨ç”¨äºä¸º AI æ¨¡å‹æä¾›**åªè¯»çš„ä¸Šä¸‹æ–‡ä¿¡æ¯**ã€‚ä¸å·¥å…·ï¼ˆToolsï¼‰ä¸åŒï¼ŒResources ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œè€Œæ˜¯ä½œä¸º**æ™ºèƒ½çŸ¥è¯†åº“**ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿè®¿é—®å’Œæ¨ç†å„ç§ç»“æ„åŒ–ä¿¡æ¯ã€‚

>âš ï¸ Resources æ˜¯çº¯ç²¹çš„ä¿¡æ¯æ¥å£ï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œä¸º AI å·¥ä½œæµæä¾›å®‰å…¨ã€å¯é¢„æµ‹çš„ä¸Šä¸‹æ–‡ä¾›ç»™æ–¹å¼ã€‚èµ„æºçš„å†…å®¹å¦‚æœå‘ç”Ÿå˜æ›´ï¼Œéœ€é‡æ–°åŠ è½½ï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡æ‰ä¼šæ„ŸçŸ¥åˆ°å˜åŒ–ã€‚

- **ç›´æ¥èµ„æº**ï¼šé€šè¿‡Â `/resources/list`Â æ¥å£æš´éœ²ï¼Œé€‚åˆé™æ€ã€å·²çŸ¥èµ„æºã€‚
- **èµ„æºæ¨¡æ¿**ï¼šä½¿ç”¨ URI æ¨¡æ¿Â `file://{path}` æš´éœ²ä»è€Œå®ç°åŠ¨æ€èµ„æºå‘ç°ï¼Œé€‚åˆå¤§è§„æ¨¡ã€åŠ¨æ€å†…å®¹ã€‚

### 11.2 Prompts

åœ¨ MCPï¼ˆModel Context Protocolï¼‰æ¡†æ¶ä¸­ï¼Œ**Prompts** æ˜¯ç¬¬ä¸‰ä¸ªæ ¸å¿ƒåŸè¯­ï¼Œç”¨äºå°è£…å¯é‡ç”¨çš„ LLM æŒ‡ä»¤æ¨¡æ¿ã€‚å¦‚æœè¯´å·¥å…·è®©æ¨¡å‹"è¡ŒåŠ¨"ï¼Œèµ„æºè®©æ¨¡å‹"è·å–ä¿¡æ¯"ï¼Œé‚£ä¹ˆæç¤ºå°±æ˜¯æŒ‡å¯¼æ¨¡å‹å¦‚ä½•"æ€è€ƒ"â€”â€”å¡‘é€ å…¶è§’è‰²ã€æ¨ç†ç­–ç•¥å’Œè¾“å‡ºæ–¹å¼ã€‚

Prompts å°† MCP ä»ç®€å•çš„ä»»åŠ¡æ‰§è¡Œå±‚æå‡ä¸º**ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„æ™ºèƒ½æ¥å£åè®®**ï¼š

1. **è®¤çŸ¥å¡‘é€ **ï¼šä¸ä»…è®© LLM åŸºäºå·¥å…·å’Œæ•°æ®è¡ŒåŠ¨ï¼Œè¿˜èƒ½ä»¥ä¸€è‡´ã€ç»“æ„åŒ–çš„æ–¹å¼è°ƒæ•´è¯­è°ƒã€ç›®çš„å’Œç›®æ ‡
2. **å¯é‡ç”¨æ€§**ï¼šå‚æ•°åŒ–æŒ‡ä»¤è®©äº¤äº’å˜å¾—å¯ç»„åˆã€å¯è§£é‡Šã€å¯å…±äº«
3. **è¡¨è¾¾åŠ›æ‰©å±•**ï¼šæç¤ºä¸ä»…æ˜¯æ¨¡æ¿ï¼Œæ›´æ˜¯æä¾›ç»™ LLM çš„å¯é‡æ–°é…ç½®çš„å¿ƒæ™ºæ¨¡å‹

é€šè¿‡ Toolsï¼ˆè¡ŒåŠ¨ï¼‰ã€Resourcesï¼ˆè®¤çŸ¥ï¼‰ã€Promptsï¼ˆæ€è€ƒï¼‰çš„ä¸‰ä½ä¸€ä½“ï¼ŒMCP æˆä¸ºè®¾è®¡æ™ºèƒ½ç³»ç»Ÿçš„å®Œæ•´è¯­è¨€ã€‚

å½“å‰ä¸»æµçš„ MCP å®¢æˆ·ç«¯å¯¹èµ„æºæ”¯æŒæ™®éè¾ƒå¼±ã€‚ç†è®ºä¸Šï¼ŒClaude Desktop åº”è¯¥åŒæ—¶æ”¯æŒæç¤ºè¯å’Œèµ„æºï¼Œä½†æˆ‘åœ¨è¯•ç”¨æ—¶æœªèƒ½æ­£å¸¸ä½¿ç”¨èµ„æºï¼›Cline è™½æ”¯æŒèµ„æºï¼Œä½†ä¸æ”¯æŒæç¤ºè¯ï¼›CherryStudio åˆ™ä¼¼ä¹éƒ½ä¸æ”¯æŒä½¿ç”¨ã€‚ä¸è¿‡ï¼Œåœ¨ Agent ä¸­ï¼Œè¿™ä¸€åˆ‡éƒ½ç”±æˆ‘ä»¬è‡ªä¸»æŒæ§ï¼Œèµ„æºä¸æç¤ºè¯çš„ä½¿ç”¨æ–¹å¼å®Œå…¨å¯å®šåˆ¶ï¼
### 11.3 æ€»ç»“

|      åŸè¯­       | æ§åˆ¶æ–¹å¼ | ä¸»è¦ç”¨é€” |       ä½¿ç”¨åœºæ™¯       |
| :-----------: | :--: | :--: | :--------------: |
|   **Tools**   | æ¨¡å‹æ§åˆ¶ | æ‰§è¡Œæ“ä½œ | åŠ¨æ€æ•°æ®è·å–ã€è®¡ç®—ã€API è°ƒç”¨ |
| **Resources** | åº”ç”¨æ§åˆ¶ | æä¾›çŸ¥è¯† |   é™æ€æ–‡æ¡£ã€é…ç½®ã€èƒŒæ™¯ä¿¡æ¯   |
|  **Prompts**  | ç”¨æˆ·æ§åˆ¶ | æŒ‡å¯¼æ€è€ƒ |   æ ‡å‡†åŒ–å·¥ä½œæµã€ä¸“ä¸šæŒ‡å¯¼    |
## 12 Sampling é‡‡æ ·

### 12.1 æ ¸å¿ƒæ¦‚å¿µ

MCPï¼ˆModel Context Protocolï¼‰é‡‡æ ·æ˜¯ä¸€ä¸ªé©å‘½æ€§çš„åŠŸèƒ½ï¼Œå®ƒå®ç°äº†**åŒå‘æ¶æ„**çš„æ ¸å¿ƒç†å¿µã€‚ä¼ ç»Ÿçš„MCPæ¶æ„ä¸­ï¼Œå®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡å™¨çš„å·¥å…·ã€èµ„æºå’Œæç¤ºï¼Œä½†é‡‡æ ·æœºåˆ¶å½»åº•æ”¹å˜äº†è¿™ç§å•å‘æµåŠ¨æ¨¡å¼ã€‚é€šè¿‡é‡‡æ ·ï¼Œ**æœåŠ¡å™¨å¯ä»¥åå‘è¯·æ±‚å®¢æˆ·ç«¯çš„LLMæ‰§è¡Œæ–‡æœ¬ç”Ÿæˆä»»åŠ¡**ï¼Œè¿™ç§"åè½¬"åˆ›é€ äº†ä¸€ä¸ªçœŸæ­£çš„åŒå‘æ™ºèƒ½åä½œç¯å¢ƒã€‚

é‡‡æ ·çš„æœ¬è´¨æ˜¯**æ™ºèƒ½ä»»åŠ¡çš„åˆ†å¸ƒå¼å§”æ‰˜**ã€‚å½“æœåŠ¡å™¨åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦è¿›è¡Œè‡ªç„¶è¯­è¨€ç†è§£ã€ç”Ÿæˆæˆ–æ¨ç†æ—¶ï¼Œå®ƒä¸å†éœ€è¦è‡ªå·±é›†æˆLLMæˆ–è°ƒç”¨å¤–éƒ¨APIï¼Œè€Œæ˜¯å¯ä»¥å°†è¿™äº›è®¡ç®—å¯†é›†å‹ä»»åŠ¡å§”æ‰˜ç»™å®¢æˆ·ç«¯çš„æ¨¡å‹ã€‚è¿™ç§è®¾è®¡å¸¦æ¥äº†æ˜¾è‘—çš„æ¶æ„ä¼˜åŠ¿ï¼šé¦–å…ˆæ˜¯**å¯æ‰©å±•æ€§**ï¼ŒæœåŠ¡å™¨é¿å…äº†è®¡ç®—å¯†é›†å‹çš„æ¨ç†å·¥ä½œï¼Œèƒ½å¤Ÿå¤„ç†æ›´å¤šå¹¶å‘è¯·æ±‚ï¼›å…¶æ¬¡æ˜¯**æˆæœ¬æ•ˆç‡**ï¼Œæ‰€æœ‰LLMç›¸å…³çš„APIæˆæœ¬å’Œè®¡ç®—è´Ÿè½½éƒ½ç”±å®¢æˆ·ç«¯æ‰¿æ‹…ï¼›ç¬¬ä¸‰æ˜¯**æ¨¡å‹é€‰æ‹©çš„çµæ´»æ€§**ï¼Œä¸åŒå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ¨¡å‹ï¼ŒæœåŠ¡å™¨æ— éœ€ä¿®æ”¹ï¼›æœ€åæ˜¯**é¿å…ç“¶é¢ˆ**ï¼Œæ¯ä¸ªç”¨æˆ·çš„ç¯å¢ƒå¤„ç†è‡ªå·±çš„è¯·æ±‚ï¼Œé˜²æ­¢æœåŠ¡å™¨ç«¯é˜Ÿåˆ—å †ç§¯ã€‚

### 12.2 æ¶æ„æµç¨‹è¯¦è§£

é‡‡æ ·çš„å®Œæ•´æ‰§è¡Œæµç¨‹ä½“ç°äº†MCPåè®®çš„ç²¾å¦™è®¾è®¡ã€‚å½“æœåŠ¡å™¨çš„å·¥å…·å‡½æ•°è¿è¡Œæ—¶ï¼Œé€šè¿‡è°ƒç”¨`ctx.sample()`æ–¹æ³•è§¦å‘é‡‡æ ·è¯·æ±‚ã€‚è¿™ä¸ªè°ƒç”¨å¹¶ä¸åœ¨æœ¬åœ°æ‰§è¡Œï¼Œè€Œæ˜¯å°†è¯·æ±‚æ‰“åŒ…æˆæ ‡å‡†åŒ–çš„MCPæ¶ˆæ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè§¦å‘ç”¨æˆ·å®šä¹‰çš„`sampling_handler()`å‡½æ•°ï¼Œè¯¥å‡½æ•°è´Ÿè´£å¤„ç†è¯·æ±‚çš„å…·ä½“é€»è¾‘ï¼ŒåŒ…æ‹¬æ ¼å¼åŒ–æç¤ºã€å¤„ç†é‡è¯•ç­‰ã€‚

å®¢æˆ·ç«¯éšåä½¿ç”¨å¤–éƒ¨LLM APIï¼ˆå¦‚OpenAIï¼‰æˆ–æœ¬åœ°æ¨¡å‹ï¼ˆå¦‚LLaMAã€Mistralï¼‰æ¥å®Œæˆè¯·æ±‚ï¼Œç”Ÿæˆçš„æ–‡æœ¬ä½œä¸ºå®Œæˆç»“æœè¿”å›ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°ç»“æœåï¼Œæ¢å¤åœ¨`ctx.sample(â€¦)`å¤„ç­‰å¾…çš„åç¨‹æ‰§è¡Œï¼Œä½¿ç”¨LLMç”Ÿæˆçš„è¾“å‡ºç»§ç»­å·¥å…·å‡½æ•°çš„æ‰§è¡Œã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼ŒæœåŠ¡å™¨çš„å·¥å…·åç¨‹ä¼šæš‚åœç›´åˆ°ç»“æœè¿”å›ï¼Œé¿å…é˜»å¡å…¶ä»–ä»»åŠ¡ã€‚

### 12.3 Contextå¯¹è±¡ä¸é‡‡æ ·æœºåˆ¶

FastMCPé€šè¿‡**Contextå¯¹è±¡**ä¸ºæœåŠ¡å™¨å‡½æ•°æä¾›å¼ºå¤§çš„èƒ½åŠ›å¥æŸ„ã€‚Contextä¸ä»…æ”¯æŒLLMé‡‡æ ·è¯·æ±‚ï¼Œè¿˜èƒ½è®¿é—®æ—¥å¿—è®°å½•ã€å‘é€æ›´æ–°ç­‰åŠŸèƒ½ã€‚FastMCPä¼šåœ¨å·¥å…·å‡½æ•°åŒ…å«Contextå‚æ•°æ—¶è‡ªåŠ¨æ³¨å…¥è¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒContextå¯¹è±¡ä»…åœ¨è¯·æ±‚æœŸé—´æœ‰æ•ˆï¼Œä¸èƒ½ä½œä¸ºå…¨å±€å˜é‡å­˜å‚¨å’Œåœ¨å·¥å…·è°ƒç”¨å¤–ä½¿ç”¨ã€‚

`ctx.sample()`æ–¹æ³•æ˜¯é‡‡æ ·åŠŸèƒ½çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒæ¥å—å¤šä¸ªå‚æ•°æ¥æ§åˆ¶ç”Ÿæˆè¡Œä¸ºã€‚`messages`å‚æ•°å¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ä¸²ï¼ˆè¢«è§†ä¸ºç”¨æˆ·æ¶ˆæ¯ï¼‰æˆ–æ¶ˆæ¯åˆ—è¡¨ï¼›`system_prompt`å‚æ•°è®¾ç½®ç³»ç»ŸæŒ‡ä»¤ï¼Œä¸ºLLMçš„è¡Œä¸ºæä¾›é«˜çº§æŒ‡å¯¼ï¼›`temperature`å‚æ•°æ§åˆ¶è¾“å‡ºçš„éšæœºæ€§ï¼Œè¾ƒä½å€¼äº§ç”Ÿæ›´ç¡®å®šæ€§çš„è¾“å‡ºï¼›`max_tokens`å‚æ•°é™åˆ¶ç”Ÿæˆçš„æœ€å¤§ä»¤ç‰Œæ•°ã€‚

### 12.4 æœåŠ¡å™¨ç«¯å®ç°

æœåŠ¡å™¨ç«¯çš„é‡‡æ ·å®ç°ç›¸å¯¹ç›´è§‚ã€‚åœ¨å·¥å…·å‡½æ•°ä¸­ï¼Œé€šè¿‡`await ctx.sample(â€¦)`è°ƒç”¨æ¥è¯·æ±‚å®¢æˆ·ç«¯LLMçš„å®Œæˆã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ–‡æ¡£æ‘˜è¦å·¥å…·å¯èƒ½ä¼šè¿™æ ·å®ç°ï¼š

```python
@mcp.tool()
async def summarize_document(text: str, ctx: Context) -> str:
    response = await ctx.sample(
        messages=f"Please summarize the following document: {text}",
        system_prompt="You are an expert summarizer. Provide concise, accurate summaries.",
        temperature=0.7,
        max_tokens=300
    )
    return response.text
```

è¿™ç§å®ç°æ–¹å¼å±•ç°äº†é‡‡æ ·çš„ä¼˜é›…æ€§ï¼šæœåŠ¡å™¨åªéœ€è¦ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œå°†å¤æ‚çš„æ–‡æœ¬ç”Ÿæˆä»»åŠ¡å§”æ‰˜ç»™å®¢æˆ·ç«¯çš„æ™ºèƒ½æ¨¡å‹ã€‚

### 12.5 å®¢æˆ·ç«¯å®ç°ä¸å¤„ç†

å®¢æˆ·ç«¯éœ€è¦å®šä¹‰ä¸€ä¸ªé‡‡æ ·å¤„ç†å‡½æ•°æ¥å“åº”æœåŠ¡å™¨çš„é‡‡æ ·è¯·æ±‚ã€‚è¿™ä¸ªå¤„ç†å‡½æ•°æ¥æ”¶`SamplingMessage`å¯¹è±¡åˆ—è¡¨ã€`SamplingParams`å‚æ•°å¯¹è±¡å’Œ`RequestContext`ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å¤„ç†å‡½æ•°çš„èŒè´£æ˜¯å°†æœåŠ¡å™¨çš„è¯·æ±‚è½¬æ¢ä¸ºé€‚åˆLLMçš„æ ¼å¼ï¼Œè°ƒç”¨ç›¸åº”çš„æ¨¡å‹APIï¼Œå¹¶è¿”å›ç”Ÿæˆçš„æ–‡æœ¬ã€‚

ä¸€ä¸ªå…¸å‹çš„é‡‡æ ·å¤„ç†å‡½æ•°ä¼šæ„å»ºç¬¦åˆLiteLLMæ ¼å¼çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œå¤„ç†ç³»ç»Ÿæç¤ºï¼Œè¿­ä»£å¤„ç†æ¶ˆæ¯å†…å®¹ï¼Œå¹¶åœ¨try/exceptå—ä¸­è°ƒç”¨LLMä»¥å¤„ç†æ½œåœ¨çš„ç½‘ç»œæˆ–APIé”™è¯¯ã€‚å¤„ç†å‡½æ•°è¿”å›çš„å­—ç¬¦ä¸²ä¼šè¢«å°è£…åœ¨TextContentå¯¹è±¡ä¸­å‘é€å›æœåŠ¡å™¨ã€‚

### 12.6 æ¨¡å‹åå¥½è®¾ç½®

FastMCPçš„é‡‡æ ·APIåŒ…å«`model_preferences`å‚æ•°ï¼Œå…è®¸æœåŠ¡å™¨æç¤ºæˆ–è¯·æ±‚å®¢æˆ·ç«¯ä½¿ç”¨ç‰¹å®šæ¨¡å‹ã€‚è¿™ä¸ªå¯é€‰åŠŸèƒ½åœ¨æŸäº›åœºæ™¯ä¸‹éå¸¸æœ‰ä»·å€¼ï¼Œæ¯”å¦‚æœåŠ¡å™¨çŸ¥é“æŸä¸ªä»»åŠ¡æœ€é€‚åˆç‰¹å®šæ¨¡å‹ï¼Œæˆ–ç”¨æˆ·æŒ‡å®šäº†æ¨¡å‹é€‰æ‹©ã€‚æ¨¡å‹åå¥½å¯ä»¥æ˜¯å•ä¸ªå­—ç¬¦ä¸²ã€å­—ç¬¦ä¸²åˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰æˆ–ç»“æ„åŒ–çš„ModelPreferenceså¯¹è±¡ã€‚

å®¢æˆ·ç«¯çš„é‡‡æ ·å¤„ç†å‡½æ•°å¯ä»¥æ£€æŸ¥`params.modelPreferences`å¹¶å†³å®šå¦‚ä½•è·¯ç”±è¯·æ±‚ã€‚ä¸è¿‡ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰ä¹‰åŠ¡éµå¾ªåå¥½è®¾ç½®ï¼Œè¿™æ›´å¤šæ˜¯ä¸€ç§æç¤ºæˆ–è¯·æ±‚ã€‚è‰¯å¥½è¡Œä¸ºçš„å®¢æˆ·ç«¯ä¼šå°è¯•ä½¿ç”¨æŒ‡å®šæ¨¡å‹ï¼Œä½†å¦‚æœæ— æ³•è®¿é—®ï¼Œä¼šä½¿ç”¨é»˜è®¤æ¨¡å‹æˆ–æ£€æŸ¥å…¶ä»–æ”¯æŒçš„åå¥½æ¨¡å‹ã€‚

### 12.7 åº”ç”¨åœºæ™¯ä¸é«˜çº§æ¨¡å¼

é‡‡æ ·å¼€å¯äº†ä¼—å¤šåº”ç”¨å¯èƒ½æ€§ã€‚**æ–‡æœ¬æ‘˜è¦**åœºæ™¯ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥è·å–æ•°æ®å¹¶è°ƒç”¨`ctx.sample`è¿›è¡Œæ‘˜è¦ï¼Œç”¨æˆ·æ— éœ€æœåŠ¡å™¨è‡ªå¸¦æ‘˜è¦æ¨¡å‹ã€‚**å¤æ‚é—®ç­”æˆ–åˆ†æ**åœºæ™¯ç»“åˆäº†é€»è¾‘å¤„ç†å’ŒLLMæ¨ç†ï¼Œæ¯”å¦‚é”€å”®æ•°æ®åˆ†æå·¥å…·å…ˆä»æ•°æ®åº“æå–æ•°å­—ï¼Œç„¶åéœ€è¦LLMè§£é‡Šè¿™äº›æ•°æ®çš„æ´å¯Ÿã€‚**æ•°æ®åˆ†ç±»**åœºæ™¯ä¸­ï¼Œè™½ç„¶ç®€å•åˆ†ç±»å¯ä»¥ç”¨ä»£ç å®Œæˆï¼Œä½†ä½¿ç”¨LLMå¯ä»¥æé«˜ç»†è‡´æ¡ˆä¾‹çš„å‡†ç¡®æ€§ã€‚

æ›´é«˜çº§çš„åº”ç”¨åŒ…æ‹¬**é“¾å¼æ¨ç†è°ƒç”¨**ï¼Œå·¥å…·å¯ä»¥å¤šæ¬¡é¡ºåºè°ƒç”¨`ctx.sample`æ¥åˆ†è§£é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæ•°å­¦æ±‚è§£å·¥å…·å¯èƒ½å…ˆè°ƒç”¨`ctx.sample`è·å–é€æ­¥æ¨ç†ï¼Œç„¶åè§£æéªŒè¯æ¨ç†è¿‡ç¨‹ï¼Œå†æ¬¡è°ƒç”¨è·å–æœ€ç»ˆç­”æ¡ˆã€‚**ä»£ç†è¡Œä¸º**æ¨¡å¼ç»“åˆå·¥å…·ä½¿ç”¨å’Œé‡‡æ ·åˆ›å»ºç±»ä¼¼ä»£ç†çš„è¡Œä¸ºï¼Œæ¯”å¦‚ç ”ç©¶å·¥å…·å†…éƒ¨ä½¿ç”¨é‡‡æ ·å¤´è„‘é£æš´é—®é¢˜åˆ—è¡¨ï¼Œä¸ºæ¯ä¸ªé—®é¢˜è°ƒç”¨APIè·å–ä¿¡æ¯ï¼Œç„¶åå†æ¬¡é‡‡æ ·è®©LLMç¼–è¯‘æŠ¥å‘Šã€‚

### 12.8 é”™è¯¯å¤„ç†ä¸æœ€ä½³å®è·µ

æ„å»ºrobustçš„MCPé‡‡æ ·æœåŠ¡å™¨éœ€è¦ä»”ç»†çš„é”™è¯¯å¤„ç†ã€‚`ctx.sample`å¯èƒ½å› ä¸ºå®¢æˆ·ç«¯é‡‡æ ·å¤„ç†å‡½æ•°å¼‚å¸¸ï¼ˆLLM APIå®•æœºã€æ— æ•ˆå‚æ•°ç­‰ï¼‰è€Œå¤±è´¥ã€‚åº”è¯¥åœ¨`ctx.sample`å‘¨å›´ä½¿ç”¨try/exceptæ•è·å¼‚å¸¸ï¼Œä½¿ç”¨`ctx.error()`å‘é€é”™è¯¯çº§åˆ«æ—¥å¿—æ¶ˆæ¯ï¼Œå¹¶è¿”å›å›é€€å­—ç¬¦ä¸²ï¼Œè¿™æ ·å·¥å…·èƒ½å¤Ÿä¼˜é›…å®Œæˆè€Œä¸æ˜¯è®©å¼‚å¸¸ä¼ æ’­ã€‚

å®‰å…¨è€ƒè™‘ä¹Ÿå¾ˆé‡è¦ã€‚é‡‡æ ·æ„å‘³ç€æœåŠ¡å™¨å‘å®¢æˆ·ç«¯LLMå‘é€æ•°æ®ï¼Œå¿…é¡»ç¡®ä¿ä¿¡ä»»å®¢æˆ·ç«¯æˆ–è‡³å°‘å®¢æˆ·ç«¯æ˜¯æ•°æ®æ‰€æœ‰è€…ã€‚å¦‚æœæœåŠ¡å™¨æŒæœ‰æ•æ„Ÿæ•°æ®è€Œå®¢æˆ·ç«¯è¯·æ±‚æ‘˜è¦ï¼Œä½¿ç”¨é‡‡æ ·å®é™…ä¸Šæ˜¯å°†æ–‡ä»¶å†…å®¹å‘é€ç»™å®¢æˆ·ç«¯LLMï¼Œå¦‚æœè¯¥LLMæ˜¯ç¬¬ä¸‰æ–¹APIï¼Œå¯èƒ½å­˜åœ¨éšç§æ³„éœ²é£é™©ã€‚

### 12.9 å®Œæ•´ä»£ç ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªé›†æˆé‡‡æ ·åŠŸèƒ½çš„å®Œæ•´MCPæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å®ç°ï¼š

```python
# server.py - MCPæœåŠ¡å™¨ç«¯
from fastmcp import FastMCP
from fastmcp.context import Context
import asyncio

mcp = FastMCP("SamplingDemo")

@mcp.tool()
async def analyze_sentiment_with_summary(text: str, ctx: Context) -> str:
    """åˆ†ææ–‡æœ¬æƒ…æ„Ÿå¹¶æä¾›è¯¦ç»†æ‘˜è¦"""
    try:
        # ç¬¬ä¸€æ¬¡é‡‡æ ·ï¼šåˆ†ææƒ…æ„Ÿ
        sentiment_response = await ctx.sample(
            messages=f"Analyze the sentiment of this text: {text}",
            system_prompt="You are a sentiment analysis expert. Classify as positive, negative, or neutral with confidence score.",
            temperature=0.3,
            max_tokens=100,
            model_preferences=["gpt-4o", "claude-3-sonnet"]
        )
        
        # ç¬¬äºŒæ¬¡é‡‡æ ·ï¼šç”Ÿæˆè¯¦ç»†æ‘˜è¦
        summary_response = await ctx.sample(
            messages=f"Provide a detailed summary of this text: {text}",
            system_prompt="You are a professional summarizer. Create comprehensive yet concise summaries.",
            temperature=0.7,
            max_tokens=200
        )
        
        return f"Sentiment Analysis: {sentiment_response.text}\n\nSummary: {summary_response.text}"
        
    except Exception as e:
        await ctx.error(f"Sampling failed: {str(e)}")
        return f"Analysis failed, but here's basic info: Text length is {len(text)} characters."

if __name__ == "__main__":
    mcp.run()

# client.py - MCPå®¢æˆ·ç«¯ç«¯
import asyncio
from fastmcp import Client
from fastmcp.types import SamplingMessage, SamplingParams, RequestContext
import litellm

async def sampling_handler(
    messages: list[SamplingMessage], 
    params: SamplingParams, 
    ctx: RequestContext
) -> str:
    """å¤„ç†æœåŠ¡å™¨çš„é‡‡æ ·è¯·æ±‚"""
    try:
        # æ„å»ºæ¶ˆæ¯æ ¼å¼
        chat_messages = []
        
        # æ·»åŠ ç³»ç»Ÿæç¤ºï¼ˆå¦‚æœæœ‰ï¼‰
        if params.systemPrompt:
            chat_messages.append({
                "role": "system", 
                "content": params.systemPrompt
            })
        
        # æ·»åŠ å¯¹è¯æ¶ˆæ¯
        for msg in messages:
            chat_messages.append({
                "role": msg.role, 
                "content": msg.content.text if hasattr(msg.content, 'text') else str(msg.content)
            })
        
        # å¤„ç†æ¨¡å‹åå¥½
        model_to_use = "gpt-3.5-turbo"  # é»˜è®¤æ¨¡å‹
        if params.modelPreferences:
            if isinstance(params.modelPreferences, list) and params.modelPreferences:
                model_to_use = params.modelPreferences[0]
            elif isinstance(params.modelPreferences, str):
                model_to_use = params.modelPreferences
        
        # è°ƒç”¨LLM
        response = await litellm.acompletion(
            model=model_to_use,
            messages=chat_messages,
            temperature=params.temperature or 0.7,
            max_tokens=params.maxTokens or 500
        )
        
        return response.choices[0].message.content
        
    except Exception as e:
        return f"Error generating response: {str(e)}"

async def main():
    # è¿æ¥åˆ°MCPæœåŠ¡å™¨
    async with Client("stdio", "python server.py", sampling_handler=sampling_handler) as client:
        # è°ƒç”¨å·¥å…·
        result = await client.call_tool(
            "analyze_sentiment_with_summary", 
            text="I absolutely love this new technology! It's revolutionary and will change everything for the better."
        )
        print("Analysis Result:")
        print(result)

if __name__ == "__main__":
    asyncio.run(main())
```

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†é‡‡æ ·çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼šæœåŠ¡å™¨ç«¯å·¥å…·è¿›è¡ŒåŒé‡é‡‡æ ·ï¼ˆæƒ…æ„Ÿåˆ†æå’Œæ‘˜è¦ç”Ÿæˆï¼‰ï¼Œå®¢æˆ·ç«¯å¤„ç†å‡½æ•°æ™ºèƒ½è·¯ç”±è¯·æ±‚åˆ°åˆé€‚çš„æ¨¡å‹ï¼Œå¹¶ä¸”åŒ…å«äº†é”™è¯¯å¤„ç†å’Œæ¨¡å‹åå¥½è®¾ç½®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæ—¢å¼ºå¤§åˆçµæ´»çš„åˆ†å¸ƒå¼AIç³»ç»Ÿï¼ŒæœåŠ¡å™¨ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œè€Œå°†æ™ºèƒ½ç”Ÿæˆä»»åŠ¡å§”æ‰˜ç»™å®¢æˆ·ç«¯çš„æ¨¡å‹èµ„æºã€‚

![image.png](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/20250630225206.png)
![image.png](https://ceyewan.oss-cn-beijing.aliyuncs.com/typora/20250701075403.png)
